# Test recursive binary tree with Own<Tree>
enum Tree:
    Leaf(i32)
    Node(Own<Tree>, Own<Tree>)

fn sum(Tree tree) i32:
    match tree:
        Tree.Leaf(value) ->
            return Result.Ok(value)
        Tree.Node(Own(left), Own(right)) ->
            let i32 left_sum = sum(left)??
            let i32 right_sum = sum(right)??
            return Result.Ok(left_sum + right_sum)

fn run_test() i32:
    # Build tree:
    #       Node
    #      /    \
    #   Leaf(5) Node
    #          /    \
    #      Leaf(3) Leaf(7)
    let Own<Tree> leaf3 = Own.alloc(Tree.Leaf(3))
    let Own<Tree> leaf7 = Own.alloc(Tree.Leaf(7))
    let Own<Tree> right_node = Own.alloc(Tree.Node(leaf3, leaf7))
    let Own<Tree> leaf5 = Own.alloc(Tree.Leaf(5))
    let Tree root = Tree.Node(leaf5, right_node)

    let i32 total = sum(root)??
    println("Sum: {total}")
    let i32 expected = 15
    return Result.Ok(total - expected)

fn main() i32:
    let i32 result = run_test().realise(99)
    return Result.Ok(result)
