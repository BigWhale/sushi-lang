# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: NotFound pattern works
# EXPECT_STDOUT_CONTAINS: PASS: PermissionDenied pattern works
# EXPECT_STDOUT_CONTAINS: PASS: AlreadyExists pattern works
# EXPECT_STDERR_EMPTY: true

# Tests pattern matching on specific error variants

enum MyFileError:
    NotFound
    PermissionDenied
    AlreadyExists

fn open_file(string path) Result<i32, MyFileError>:
    if (path == "missing.txt"):
        return Result.Err(MyFileError.NotFound)
    if (path == "forbidden.txt"):
        return Result.Err(MyFileError.PermissionDenied)
    if (path == "exists.txt"):
        return Result.Err(MyFileError.AlreadyExists)
    return Result.Ok(42)

fn main() i32:
    match open_file("missing.txt"):
        Result.Ok(_) ->
            println("FAIL: Should have gotten NotFound")
            return Result.Ok(1)
        Result.Err(MyFileError.NotFound) ->
            println("PASS: NotFound pattern works")
        Result.Err(_) ->
            println("FAIL: Wrong error variant")
            return Result.Ok(1)

    match open_file("forbidden.txt"):
        Result.Ok(_) ->
            println("FAIL: Should have gotten PermissionDenied")
            return Result.Ok(1)
        Result.Err(MyFileError.PermissionDenied) ->
            println("PASS: PermissionDenied pattern works")
        Result.Err(_) ->
            println("FAIL: Wrong error variant")
            return Result.Ok(1)

    match open_file("exists.txt"):
        Result.Ok(_) ->
            println("FAIL: Should have gotten AlreadyExists")
            return Result.Ok(1)
        Result.Err(MyFileError.AlreadyExists) ->
            println("PASS: AlreadyExists pattern works")
        Result.Err(_) ->
            println("FAIL: Wrong error variant")
            return Result.Ok(1)

    return Result.Ok(0)
