# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: Wildcard error pattern works
# EXPECT_STDERR_EMPTY: true

# Tests pattern matching with wildcard for any error

enum MyIoError:
    ReadError
    WriteError
    FlushError

fn do_io(i32 code) string | MyIoError:
    if (code == 1):
        return Result.Err(MyIoError.ReadError)
    if (code == 2):
        return Result.Err(MyIoError.WriteError)
    if (code == 3):
        return Result.Err(MyIoError.FlushError)
    return Result.Ok("success")

fn main() i32:
    let i32 error_count = 0

    match do_io(1):
        Result.Ok(_) ->
            println("FAIL: Should have gotten error")
            return Result.Ok(1)
        Result.Err(_) ->
            error_count := error_count + 1

    match do_io(2):
        Result.Ok(_) ->
            println("FAIL: Should have gotten error")
            return Result.Ok(1)
        Result.Err(_) ->
            error_count := error_count + 1

    match do_io(3):
        Result.Ok(_) ->
            println("FAIL: Should have gotten error")
            return Result.Ok(1)
        Result.Err(_) ->
            error_count := error_count + 1

    if (error_count == 3):
        println("PASS: Wildcard error pattern works")
        return Result.Ok(0)
    else:
        println("FAIL: Wrong error count")
        return Result.Ok(1)
