# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: FileError.NotFound works
# EXPECT_STDOUT_CONTAINS: PASS: FileError.PermissionDenied works
# EXPECT_STDOUT_CONTAINS: PASS: FileError.AlreadyExists works
# EXPECT_STDOUT_CONTAINS: PASS: FileError.InvalidPath works
# EXPECT_STDOUT_CONTAINS: PASS: FileError.IOError works
# EXPECT_STDERR_EMPTY: true

# Tests FileError enum variants

fn open_file(string path) i32 | FileError:
    if (path == "missing"):
        return Result.Err(FileError.NotFound)
    if (path == "forbidden"):
        return Result.Err(FileError.PermissionDenied)
    if (path == "exists"):
        return Result.Err(FileError.AlreadyExists)
    if (path == "bad/path"):
        return Result.Err(FileError.InvalidPath)
    if (path == "io_fail"):
        return Result.Err(FileError.IOError)
    return Result.Ok(42)

fn main() i32:
    match open_file("missing"):
        Result.Err(FileError.NotFound) ->
            println("PASS: FileError.NotFound works")
        _ ->
            println("FAIL: NotFound pattern failed")
            return Result.Ok(1)

    match open_file("forbidden"):
        Result.Err(FileError.PermissionDenied) ->
            println("PASS: FileError.PermissionDenied works")
        _ ->
            println("FAIL: PermissionDenied pattern failed")
            return Result.Ok(1)

    match open_file("exists"):
        Result.Err(FileError.AlreadyExists) ->
            println("PASS: FileError.AlreadyExists works")
        _ ->
            println("FAIL: AlreadyExists pattern failed")
            return Result.Ok(1)

    match open_file("bad/path"):
        Result.Err(FileError.InvalidPath) ->
            println("PASS: FileError.InvalidPath works")
        _ ->
            println("FAIL: InvalidPath pattern failed")
            return Result.Ok(1)

    match open_file("io_fail"):
        Result.Err(FileError.IOError) ->
            println("PASS: FileError.IOError works")
        _ ->
            println("FAIL: IOError pattern failed")
            return Result.Ok(1)

    return Result.Ok(0)
