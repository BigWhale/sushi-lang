# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: Early return from error propagation works
# EXPECT_STDERR_EMPTY: true

# Tests that error propagation performs early return

enum MyError:
    Error

fn fails() i32 | MyError:
    return Result.Err(MyError.Error)

fn should_not_execute() i32 | MyError:
    let i32 value = fails()??
    println("FAIL: This line should never execute")
    return Result.Ok(value)

fn main() i32:
    match should_not_execute():
        Result.Ok(_) ->
            println("FAIL: Should have propagated error")
            return Result.Ok(1)
        Result.Err(MyError.Error) ->
            println("PASS: Early return from error propagation works")
            return Result.Ok(0)
        Result.Err(_) ->
            println("FAIL: Wrong error")
            return Result.Ok(1)
