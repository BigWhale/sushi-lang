# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: Error propagation preserves error type
# EXPECT_STDERR_EMPTY: true

# Tests error propagation with matching error types

enum DbError:
    ConnectionFailed
    QueryFailed

fn connect() Result<i32, DbError>:
    return Result.Err(DbError.ConnectionFailed)

fn query() Result<string, DbError>:
    connect()??
    return Result.Ok("data")

fn main() i32:
    match query():
        Result.Ok(_) ->
            println("FAIL: Should have propagated error")
            return Result.Ok(1)
        Result.Err(DbError.ConnectionFailed) ->
            println("PASS: Error propagation preserves error type")
            return Result.Ok(0)
        Result.Err(_) ->
            println("FAIL: Wrong error type")
            return Result.Ok(1)
