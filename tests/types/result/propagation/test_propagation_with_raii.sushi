# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: Error propagated with RAII cleanup
# EXPECT_STDERR_EMPTY: true

# Tests RAII cleanup during error propagation

enum MyError:
    Error

fn allocate_array() i32[] | MyError:
    return Result.Err(MyError.Error)

fn process_data() i32 | MyError:
    let i32[] temp = from([1, 2, 3, 4, 5])
    allocate_array()??
    println("RAII test: temp array has {temp.len()} elements")
    return Result.Ok(42)

fn main() i32:
    match process_data():
        Result.Ok(_) ->
            println("FAIL: Should have propagated error")
            return Result.Ok(1)
        Result.Err(MyError.Error) ->
            println("PASS: Error propagated with RAII cleanup")
            return Result.Ok(0)
        Result.Err(_) ->
            println("FAIL: Wrong error")
            return Result.Ok(1)
