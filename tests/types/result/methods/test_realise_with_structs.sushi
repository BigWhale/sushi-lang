# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: realise returns Ok value for structs
# EXPECT_STDOUT_CONTAINS: PASS: realise returns default for Err
# EXPECT_STDERR_EMPTY: true

# Tests realise with struct default values

struct Config:
    i32 port
    string host

enum MyError:
    Error

fn load_config(bool fail) Config | MyError:
    if (fail):
        return Result.Err(MyError.Error)
    return Result.Ok(Config(8080, "localhost"))

fn main() i32:
    let Config default_config = Config(3000, "0.0.0.0")

    let Config cfg1 = load_config(false).realise(default_config)
    if (cfg1.port == 8080 and cfg1.host == "localhost"):
        println("PASS: realise returns Ok value for structs")
    else:
        println("FAIL: Wrong config from Ok")
        return Result.Ok(1)

    let Config cfg2 = load_config(true).realise(default_config)
    if (cfg2.port == 3000 and cfg2.host == "0.0.0.0"):
        println("PASS: realise returns default for Err")
        return Result.Ok(0)
    else:
        println("FAIL: Wrong config from Err")
        return Result.Ok(1)
