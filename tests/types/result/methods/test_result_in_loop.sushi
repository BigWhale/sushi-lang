# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: PASS: Result methods in loop work
# EXPECT_STDERR_EMPTY: true

# Tests Result methods used in loops

enum MyError:
    Error

fn check_value(i32 n) i32 | MyError:
    if (n < 0):
        return Result.Err(MyError.Error)
    return Result.Ok(n * 2)

fn main() i32:
    let i32 ok_count = 0
    let i32 err_count = 0

    foreach(i in 0..5):
        let Result<i32, MyError> r = check_value(i)
        if (r.is_ok()):
            ok_count := ok_count + 1
        if (r.is_err()):
            err_count := err_count + 1

    foreach(i in -3..0):
        let Result<i32, MyError> r = check_value(i)
        if (r.is_ok()):
            ok_count := ok_count + 1
        if (r.is_err()):
            err_count := err_count + 1

    if (ok_count == 5 and err_count == 3):
        println("PASS: Result methods in loop work")
        return Result.Ok(0)
    else:
        println("FAIL: Wrong counts")
        return Result.Ok(1)
