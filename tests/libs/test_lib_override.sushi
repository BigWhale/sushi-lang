# Test main overriding library functions
# EXPECT_RUNTIME_EXIT: 0
# EXPECT_STDOUT_CONTAINS: "library_only() = 42"
# EXPECT_STDOUT_CONTAINS: "All override tests passed"
#
# Tests that main program symbols take priority over library symbols.
# Main defines get_value() which should shadow the library's version.
# Symbol priority: Main (1) > Library (2) > Stdlib (3) > Runtime (4)

use <lib/override_lib>

# This function overrides the library's get_value()
fn get_value() i32:
    return Result.Ok(500)

fn main() i32:
    # library_only() should work - it's only in the library
    let Result<i32, StdError> r = library_only()
    match r:
        Result.Ok(lib_val) ->
            println("library_only() = {lib_val}")
            if (lib_val != 42):
                println("FAIL: Expected library_only() = 42")
                return Result.Ok(1)
        Result.Err(_) ->
            println("FAIL: library_only() returned error")
            return Result.Ok(1)

    # Note: use_value() from the library still calls the LIBRARY's get_value()
    # because the library was compiled with its own internal reference.
    # Main's get_value() only shadows at the linker level for new calls.

    println("All override tests passed")
    return Result.Ok(0)
