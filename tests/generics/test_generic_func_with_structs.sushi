# EXPECT_RUNTIME_EXIT: 0
# TEST_TYPE: runtime

# Test generic functions using generic struct types
# This tests body substitution with generic struct instantiation

struct Box<T>:
    T value

struct Pair<T, U>:
    T first
    U second

fn box_value<T>(T item) Box<T>:
    # Create generic struct with generic type parameter
    let Box<T> result = Box(item)
    return Result.Ok(result)

fn make_pair<T, U>(T a, U b) Pair<T, U>:
    # Create generic struct with multiple generic type parameters
    let Pair<T, U> result = Pair(a, b)
    return Result.Ok(result)

fn unbox<T>(Box<T> boxed) T:
    # Extract value from generic struct
    let T value = boxed.value
    return Result.Ok(value)

fn run_test() i32:
    # Test with i32
    let Box<i32> box1 = box_value(42)??
    let i32 val1 = unbox(box1)??
    if (val1 != 42):
        return Result.Ok(1)

    # Test with string
    let Box<string> box2 = box_value("test")??
    let string val2 = unbox(box2)??
    println(val2)

    # Test pair with mixed types
    let Pair<i32, string> p1 = make_pair(100, "hello")??
    if (p1.first != 100):
        return Result.Ok(2)

    # Test pair with same types
    let Pair<i32, i32> p2 = make_pair(10, 20)??
    if (p2.first != 10 or p2.second != 20):
        return Result.Ok(3)

    return Result.Ok(0)

fn main() i32:
    let i32 result = run_test().realise(99)
    return Result.Ok(result)
