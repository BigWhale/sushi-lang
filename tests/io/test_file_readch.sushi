# TEST_TYPE: runtime
# EXPECTED_OUTPUT: Reading character by character:
# EXPECTED_OUTPUT: H
# EXPECTED_OUTPUT: e
# EXPECTED_OUTPUT: l
# EXPECTED_OUTPUT: l
# EXPECTED_OUTPUT: o
# EXPECTED_OUTPUT: Read 5 characters

use <io/stdio>
use <io/files>
use <collections/strings>

fn main() i32:
    # Write test file
    let FileResult write_result = open("test_readch_output.txt", FileMode.Write())
    match write_result:
        FileResult.Ok(out) ->
            out.write("Hello")
            out.close()
        FileResult.Err(_) ->
            stderr.write("Error: cannot create test file\n")
            return Result.Err(StdError.Error)

    # Read file character by character using readch()
    let FileResult read_result = open("test_readch_output.txt", FileMode.Read())
    match read_result:
        FileResult.Ok(f) ->
            println("Reading character by character:")
            let i32 count = 0

            let string ch = f.readch()
            while (ch != ""):
                println(ch)
                count := count + 1
                ch := f.readch()

            f.close()

            println("Read {count} characters")
            return Result.Ok(0)
        FileResult.Err(_) ->
            stderr.write("Error: cannot read test file\n")
            return Result.Err(StdError.Error)

    return Result.Ok(0)
