# Test automatic HashMap resize with tombstones
fn main() i32:
    let HashMap<i32, string> map = HashMap.new()

    # Insert items
    map.insert(1, "one")
    map.insert(2, "two")
    map.insert(3, "three")
    map.insert(4, "four")
    map.insert(5, "five")
    map.insert(6, "six")
    map.insert(7, "seven")
    map.insert(8, "eight")
    map.insert(9, "nine")
    map.insert(10, "ten")

    # Remove some items to create tombstones
    map.remove(2)
    map.remove(4)
    map.remove(6)
    map.remove(8)

    println("After 10 inserts and 4 removes:")
    println("  size = 6, tombstones = 4")
    println("  load factor = (6 + 4) / 16 = 0.625 (no resize yet)")

    # Add more items
    # With size=6, tombstones=4, we have 10 occupied slots (including tombstones)
    # Resize when (size + tombstones) > 12
    # So we need size + tombstones = 13 to trigger resize
    # Currently: 6 + 4 = 10, need 3 more items
    map.insert(11, "eleven")
    map.insert(12, "twelve")
    map.insert(13, "thirteen")

    # Now size=9, tombstones=4, total=13
    # Next insert should trigger resize
    println("\nBefore insert 14: size=9, tombstones=4, capacity=16")

    map.insert(14, "fourteen")

    println("\nAfter insert 14 (should have auto-resized to capacity 32):")
    map.debug()

    # After resize, tombstones should be cleared
    let i32 tomb_count = map.tombstone_count()
    if (tomb_count == 0):
        println("\n✓ Tombstones cleared after resize")

    let i32 size = map.len()
    if (size == 10):
        println("✓ Correct size after resize (10 items)")

    # Verify removed keys are still gone
    if (map.contains_key(2) == 0):
        println("✓ Removed key 2 still not present")

    # Verify new key exists
    if (map.contains_key(14)):
        println("✓ New key 14 exists after resize")

    return Result.Ok(0)
