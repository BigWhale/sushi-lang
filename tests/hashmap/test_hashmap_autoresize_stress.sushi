# Stress test for HashMap automatic resize
fn main() i32:
    let HashMap<i32, i32> map = HashMap.new()

    # Insert 100 items - should trigger multiple resizes
    # Starting capacity: 16
    # Resize at: 13, 26, 52, 104 items (load factor > 0.75)
    let i32 i = 1
    while (i <= 100):
        map.insert(i, i * 10)
        i := i + 1

    let i32 size = map.len()
    if (size != 100):
        println("ERROR: Expected size 100, got {size}")
        return Result.Ok(1)

    println("✓ Inserted 100 items successfully")

    # Verify we can retrieve all values
    let i32 j = 1
    let i32 errors = 0
    while (j <= 100):
        if (map.get(j).is_some()):
            j := j + 1
        else:
            errors := errors + 1
            j := j + 1

    if (errors > 0):
        println("ERROR: Failed to retrieve {errors} values")
        return Result.Ok(1)

    println("✓ All 100 values retrievable")

    # Verify final capacity is >= 100 / 0.75 = 133.33, so at least 128
    # With doubling: 16 -> 32 -> 64 -> 128
    println("\nFinal state after 100 insertions:")
    map.debug()

    println("\n✓ Stress test passed!")
    return Result.Ok(0)
