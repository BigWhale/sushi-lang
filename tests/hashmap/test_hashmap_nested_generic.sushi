# Test HashMap with nested generic types

fn main() i32:
    # Test HashMap with Maybe<i32> values (nested generic)
    let HashMap<string, Maybe<i32>> config = HashMap.new()

    # Insert entries with Some and None values
    config.insert("max_connections", Maybe.Some(100))
    config.insert("timeout", Maybe.Some(30))
    config.insert("buffer_size", Maybe.None())

    # Check size
    if (config.len() == 3):
        println("✓ HashMap has 3 entries")
    else:
        println("✗ Expected 3 entries")

    # Test get with Some value
    let Maybe<Maybe<i32>> result1 = config.get("max_connections")
    match result1:
        Maybe.Some(value) ->
            match value:
                Maybe.Some(num) ->
                    println("max_connections = {num}")
                Maybe.None() ->
                    println("✗ Unexpected None")
        Maybe.None() ->
            println("✗ Key not found")

    # Test get with None value
    let Maybe<Maybe<i32>> result2 = config.get("buffer_size")
    match result2:
        Maybe.Some(value) ->
            match value:
                Maybe.Some(num) ->
                    println("✗ Unexpected value: {num}")
                Maybe.None() ->
                    println("✓ buffer_size is None as expected")
        Maybe.None() ->
            println("✗ Key not found")

    # Test contains_key
    if (config.contains_key("timeout")):
        println("✓ timeout key exists")
    else:
        println("✗ timeout should exist")

    # Update with different Maybe value
    config.insert("buffer_size", Maybe.Some(4096))

    let Maybe<Maybe<i32>> result3 = config.get("buffer_size")
    match result3:
        Maybe.Some(value) ->
            match value:
                Maybe.Some(num) ->
                    println("Updated buffer_size = {num}")
                Maybe.None() ->
                    println("✗ Should have Some value now")
        Maybe.None() ->
            println("✗ Key not found")

    # Remove a key
    let Maybe<Maybe<i32>> removed = config.remove("timeout")

    match removed:
        Maybe.Some(_) ->
            println("✓ Removed timeout")
        Maybe.None() ->
            println("✗ Failed to remove")

    # Verify size after removal
    if (config.len() == 2):
        println("✓ HashMap has 2 entries after removal")
    else:
        println("✗ Expected 2 entries after removal")

    return Result.Ok(0)
