# Test clone() method for dynamic arrays
# This test verifies that clone creates independent deep copies

fn run_test() i32:
    # Test 1: Basic clone using rebind pattern
    let i32[] arr1 = from([1, 2, 3])
    let i32[] arr2 = new()
    arr2 := arr1.clone()

    # Both arrays should have same data
    println(arr1.len())  # Should print 3
    println(arr2.len())  # Should print 3
    println(arr1.get(0)??) # Should print 1
    println(arr2.get(0)??) # Should print 1

    # Modify arr1 - arr2 should be unaffected
    arr1.push(4)
    println(arr1.len())  # Should print 4
    println(arr2.len())  # Should print 3 (unchanged)

    # Modify arr2 - arr1 should be unaffected
    arr2.push(5)
    println(arr1.len())  # Should print 4 (unchanged)
    println(arr2.len())  # Should print 4

    # Test 2: Clone empty array
    let i32[] empty1 = new()
    let i32[] empty2 = new()
    empty2 := empty1.clone()

    println(empty1.len())  # Should print 0
    println(empty2.len())  # Should print 0

    # Add to cloned empty array
    empty2.push(42)
    println(empty1.len())  # Should print 0 (unchanged)
    println(empty2.len())  # Should print 1
    println(empty2.get(0)??) # Should print 42

    # Test 3: Clone and rebind
    let i32[] arr3 = from([10, 20, 30])
    let i32[] arr4 = new()
    arr4 := arr3.clone()  # Clone using rebind

    println(arr3.len())  # Should print 3
    println(arr4.len())  # Should print 3

    arr3.push(40)
    arr4.push(50)

    println(arr3.len())  # Should print 4
    println(arr4.len())  # Should print 4
    println(arr3.get(3)??) # Should print 40
    println(arr4.get(3)??) # Should print 50

    # Test 4: Clone string arrays
    let string[] strs1 = from(["hello", "world"])
    let string[] strs2 = new()
    strs2 := strs1.clone()

    println(strs1.len())  # Should print 2
    println(strs2.len())  # Should print 2

    strs1.push("!")
    println(strs1.len())  # Should print 3
    println(strs2.len())  # Should print 2 (unchanged)

    return Result.Ok(0)

fn main() i32:
    let i32 result = run_test().realise(99)
    return Result.Ok(result)
