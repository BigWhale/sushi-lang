use <io/files>
use <io/stdio>

fn main() i32:
    match open("/tmp/test_copy_src.txt", FileMode.Write()):
        FileResult.Ok(f) ->
            f.write("test content for copying")
            f.close()
        FileResult.Err(_) ->
            return Result.Ok(1)

    match copy("/tmp/test_copy_src.txt", "/tmp/test_copy_dst.txt"):
        Result.Ok(_) -> println("Copied")
        Result.Err(_) -> return Result.Ok(1)

    if (not exists("/tmp/test_copy_src.txt")):
        println("ERROR: Source file should still exist")
        return Result.Ok(1)

    if (not exists("/tmp/test_copy_dst.txt")):
        println("ERROR: Destination file should exist")
        return Result.Ok(1)

    match remove("/tmp/test_copy_src.txt"):
        Result.Ok(_) -> println("Cleaned src")
        Result.Err(_) -> return Result.Ok(1)

    match remove("/tmp/test_copy_dst.txt"):
        Result.Ok(_) -> println("Cleaned dst")
        Result.Err(_) -> return Result.Ok(1)

    println("OK: copy() works")
    return Result.Ok(0)
