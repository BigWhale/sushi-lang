# Test stdlib file I/O methods
# This test exercises all 12 file methods using the stdlib IR implementation

use <io/files>

fn main() i32:
    # Test writing to a file
    let FileResult result = open("/tmp/sushi_test_file.txt", FileMode.Write())
    match result:
        FileResult.Ok(f) ->
            # Test write and writeln
            f.write("Mostly ")
            f.writeln("Harmless")
            f.write("Line 2")
            f.close()
        FileResult.Err(_) ->
            println("Failed to open file for writing")
            return Result.Ok(1)

    # Test reading from the file
    let FileResult read_result = open("/tmp/sushi_test_file.txt", FileMode.Read())
    match read_result:
        FileResult.Ok(f) ->
            # Test readln
            let string line1 = f.readln()
            println("Read line 1: {line1}")

            # Test readch
            let string ch1 = f.readch()
            println("Read char: {ch1}")

            f.close()
        FileResult.Err(_) ->
            println("Failed to open file for reading")
            return Result.Ok(1)

    # Test is_open
    let FileResult check_result = open("/tmp/sushi_test_file.txt", FileMode.Read())
    match check_result:
        FileResult.Ok(f) ->
            if (f.is_open()):
                println("File is open")
            f.close()
        FileResult.Err(_) ->
            println("Failed")

    println("File I/O tests complete!")
    return Result.Ok(0)
