# TEST_TYPE: runtime
# EXPECT_RUNTIME_EXIT: 0
# Test RAII for nested structs with dynamic array fields

struct Inner:
    i32[] values
    string label

struct Outer:
    Inner data
    string name

fn test_nested_raii() i32:
    let Outer o = Outer(Inner(new(), "inner"), "outer")

    o.data.values.push(42)
    o.data.values.push(43)

    println("First value: {o.data.values.get(0)??}")
    println("Second value: {o.data.values.get(1)??}")
    println("Inner label: {o.data.label}")
    println("Outer name: {o.name}")

    # NO manual o.data.values.destroy() call!
    # RAII should automatically clean up nested struct fields
    return Result.Ok(0)

fn main() i32:
    let Result<i32> result = test_nested_raii()
    if (result):
        return Result.Ok(0)
    return Result.Err()
