# TEST_TYPE: runtime
# EXPECT_RUNTIME_EXIT: 0
# Test RAII for struct rebinding - cleanup of old value before assignment

struct Container:
    i32[] numbers
    string name

fn test_rebind() i32:
    let Container c = Container(new(), "first")
    c.numbers.push(10)
    c.numbers.push(20)

    println("Before rebind: {c.name}")
    println("Before rebind length: {c.numbers.len()}")

    # Rebind to new struct - old struct's array should be automatically cleaned up
    c := Container(new(), "second")
    c.numbers.push(30)
    c.numbers.push(40)
    c.numbers.push(50)

    println("After rebind: {c.name}")
    println("After rebind length: {c.numbers.len()}")

    # NO manual cleanup needed - RAII handles both old and new values
    return Result.Ok(0)

fn main() i32:
    let Result<i32> result = test_rebind()
    if (result):
        return Result.Ok(0)
    return Result.Err()
